<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AuthLab â€“ Guestbook {% if state == 'poc' %}(Vulnerable){% else %}(Safe){% endif %}</title>
  </head>
  <body>
    <h1>Guestbook {% if state == 'poc' %}(Vulnerable){% else %}(Safe){% endif %}</h1>

    {% if error %}
      <p style="color:#b00">{{ error }}</p>
    {% endif %}

    <form method="post" action="/guestbook" autocomplete="off">
      <label>Message
        <textarea name="message" rows="3" cols="60" placeholder="Say hello"
                  {% if max_len %}maxlength="{{ max_len }}"{% endif %} required></textarea>
      </label>
      <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
      <button type="submit">Post</button>
    </form>

    <hr>
    <h2>Messages (newest first)</h2>

    <ul>
      {% for m in messages|reverse %}
        <li>
          <small>{{ m.ts }} - {{ m.user }}</small><br>

          {% if state == 'poc' %}
            {# Vulnerable branch: autoescape is disabled - stored XSS #}
            {% autoescape false %}{{ m.message }}{% endautoescape %}
            {# Alternative (equally dangerous): {{ m.message | safe }} #}
          {% else %}
            {# Safe branch: rely on Jinja autoescape (default) #}
            {{ m.message }}
          {% endif %}
        </li>
      {% endfor %}
    </ul>

    <p><a href="/dashboard">Back to dashboard</a></p>
  </body>
</html>
